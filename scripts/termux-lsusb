#!/data/data/com.termux/files/usr/bin/bash

# Default values
export BRIDGE_LSUSB_VERBOSE=""
export BRIDGE_LOG_LEVEL=0

# Parse command line arguments
while [[ "$#" -gt 0 ]]; do
    case $1 in
        -v|--verbose)
            export BRIDGE_LSUSB_VERBOSE="-v"
            shift
            ;;
        -l|--log-level)
            export BRIDGE_LOG_LEVEL="$2"
            shift 2
            ;;
        -h|--help)
            echo "Usage: termux-lsusb [options]"
            echo "Options:"
            echo "  -v, --verbose    Use verbose output (lsusb -v)"
            echo "  -l level         Set libusb log level (0-4, default 0)"
            exit 0
            ;;
        *) echo "Unknown parameter passed: $1"; exit 1 ;;
    esac
done

USB_PATH=$(termux-usb -l | grep -o "/dev/bus/usb/[0-9]*/[0-9]*" | head -n 1)

if [ -z "$USB_PATH" ]; then
    echo "Error: No USB device found."
    exit 1
fi

echo "Found USB device at $USB_PATH. Requesting permission..."
termux-usb -r -e run_lsusb.sh "$USB_PATH"
